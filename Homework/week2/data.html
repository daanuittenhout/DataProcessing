<!doctype html>

<html>

<head>
  <h1>
    I got the right average temperature to shelter you from the storm!
    Oh lord, gal I got the right program to turn you on!
  </h1>
<style>

</style>

</head>

<body>


// create canvas
<canvas id="graph" width = "650" height = "450 "> </canvas>
// raw data
<textarea id="rawdata">

  20170101,5
  20170102,30
  20170103,50
  20170104,58
  20170105,0
  20170106,-30
  20170107,-2
  20170108,43
  20170109,48
  20170110,53
  20170111,72
  20170112,52
  20170113,31
  20170114,18
  20170115,7
  20170116,-16
  20170117,-34
  20170118,-38
  20170119,-20
  20170120,-3
  20170121,-2
  20170122,-17
  20170123,16
  20170124,8
  20170125,-11
  20170126,-28
  20170127,8
  20170128,54
  20170129,47
  20170130,49
  20170131,37
  20170201,34
  20170202,86
  20170203,86
  20170204,57
  20170205,44
  20170206,43
  20170207,24
  20170208,0
  20170209,-16
  20170210,-23
  20170211,-4
  20170212,7
  20170213,22
  20170214,38
  20170215,74
  20170216,68
  20170217,70
  20170218,56
  20170219,62
  20170220,91
  20170221,96
  20170222,95
  20170223,80
  20170224,45
  20170225,58
  20170226,87
  20170227,87
  20170228,47
  20170301,63
  20170302,66
  20170303,59
  20170304,92
  20170305,69
  20170306,60
  20170307,67
  20170308,59
  20170309,77
  20170310,65
  20170311,73
  20170312,79
  20170313,65
  20170314,88
  20170315,90
  20170316,94
  20170317,83
  20170318,97
  20170319,113
  20170320,103
  20170321,75
  20170322,63
  20170323,82
  20170324,84
  20170325,85
  20170326,80
  20170327,92
  20170328,113
  20170329,126
  20170330,157
  20170331,145
  20170401,108
  20170402,103
  20170403,81
  20170404,98
  20170405,92
  20170406,81
  20170407,105
  20170408,96
  20170409,117
  20170410,98
  20170411,96
  20170412,98
  20170413,93
  20170414,99
  20170415,96
  20170416,79
  20170417,65
  20170418,61
  20170419,39
  20170420,69
  20170421,111
  20170422,78
  20170423,66
  20170424,93
  20170425,59
  20170426,50
  20170427,61
  20170428,76
  20170429,76
  20170430,123
  20170501,117
  20170502,100
  20170503,107
  20170504,104
  20170505,89
  20170506,128
  20170507,117
  20170508,97
  20170509,80
  20170510,90
  20170511,154
  20170512,155
  20170513,140
  20170514,134
  20170515,149
  20170516,204
  20170517,223
  20170518,165
  20170519,136
  20170520,125
  20170521,144
  20170522,176
  20170523,161
  20170524,159
  20170525,174
  20170526,203
  20170527,229
  20170528,205
  20170529,219
  20170530,183
  20170531,174
  20170601,166
  20170602,198
  20170603,184
  20170604,154
  20170605,171
  20170606,141
  20170607,140
  20170608,168
  20170609,165
  20170610,178
  20170611,199
  20170612,161
  20170613,163
  20170614,174
  20170615,200
  20170616,162
  20170617,186
  20170618,208
  20170619,246
  20170620,216
  20170621,214
  20170622,229
  20170623,196
  20170624,171
  20170625,175
  20170626,168
  20170627,173
  20170628,180
  20170629,175
  20170630,162
  20170701,161
  20170702,156
  20170703,166
  20170704,186
  20170705,190
  20170706,199
  20170707,206
  20170708,186
  20170709,172
  20170710,196
  20170711,177
  20170712,149
  20170713,146
  20170714,142
  20170715,172
  20170716,186
  20170717,186
  20170718,199
  20170719,235
  20170720,191
  20170721,182
  20170722,194
  20170723,160
  20170724,161
  20170725,167
  20170726,190
  20170727,185
  20170728,172
  20170729,182
  20170730,188
  20170731,181
  20170801,178
  20170802,176
  20170803,190
  20170804,183
  20170805,159
  20170806,158
  20170807,168
  20170808,162
  20170809,167
  20170810,157
  20170811,167
  20170812,168
  20170813,162
  20170814,179
  20170815,179
  20170816,176
  20170817,173
  20170818,169
  20170819,154
  20170820,158
  20170821,159
  20170822,182
  20170823,196
  20170824,179
  20170825,169
  20170826,182
  20170827,178
  20170828,187
  20170829,210
  20170830,178
  20170831,144
  20170901,147
  20170902,133
  20170903,130
  20170904,158
  20170905,186
  20170906,159
  20170907,156
  20170908,151
  20170909,132
  20170910,139
  20170911,141
  20170912,146
  20170913,141
  20170914,117
  20170915,125
  20170916,106
  20170917,108
  20170918,120
  20170919,120
  20170920,135
  20170921,134
  20170922,119
  20170923,109
  20170924,121
  20170925,142
  20170926,132
  20170927,136
  20170928,158
  20170929,171
  20170930,131
  20171001,141
  20171002,156
  20171003,136
  20171004,130
  20171005,129
  20171006,116
  20171007,122
  20171008,121
  20171009,121
  20171010,143
  20171011,148
  20171012,134
  20171013,153
  20171014,148
  20171015,158
  20171016,186
  20171017,129
  20171018,137
  20171019,157
  20171020,137
  20171021,132
  20171022,108
  20171023,126
  20171024,153
  20171025,142
  20171026,140
  20171027,118
  20171028,124
  20171029,107
  20171030,83
  20171031,101
  20171101,112
  20171102,98
  20171103,88
  20171104,106
  20171105,78
  20171106,48
  20171107,33
  20171101,81
  20171102,72
  20171103,67
  20171104,76
  20171105,69
  20171106,61
  20171107,42
  20171108,19
  20171109,30
  20171110,40
  20171111,18
  20171112,20
  20171113,27
  20171114,31
  20171115,108
  20171116,119
  20171117,93
  20171118,60
  20171119,58
  20171120,84
  20171121,120
  20171122,110
  20171123,79
  20171124,66
  20171125,33
  20171126,-1
  20171127,56
  20171128,-3
  20171129,-31
  20171130,20
  20171201,79
  20171202,52
  20171203,-1
  20171204,-14
  20171205,-27
  20171206,1
  20171207,63
  20171208,82
  20171209,91
  20171210,78
  20171211,85
  20171212,53
  20171213,66
  20171214,73
  20171215,65
  20171216,54
  20171217,61
  20171218,62
  20171219,43
  20171220,-6
  20171221,41
  20171222,59
  20171223,60
  20171224,79
  20171225,104
  20171226,83
  20171227,66
  20171228,10
  20171229,-22
  20171230,-11
  20171231,18
</textarea>
<script>
// create XMLHttpRequest
var xhttp = new XMLHttpRequest();
// when ready run
xhttp.onreadystatechange = function(){
  // check requirements to run
  if (this.readyState == 4 && this.status == 200){
    var canvas = document.getElementById("graph")
    var ctx = canvas.getContext("2d");

    // check if the data is not null
    if (this.responseText != null){
      // split the data
        var data = this.responseText.split("\n");
        var temp = [];
        var dates = [];
        // divide the data in a date and a temperature
        for (var i = 1; i < data.length; i++ ){
          var year = data[i].substring(0,4);
      	  var month = data[i].substring(4,6);
      	  var day = data[i].substring(6,8);
      	  var date = new Date(year, month - 1, day);
          if (date[i] != ""){
            dates.push(date);
            temp.push (Number(data[i].slice(9)));
          }
        }
        // calculate maximum and minimum
        var max = temp.reduce(function(a, b) {
          return Math.max(a, b);
        })
        var min = temp.reduce(function(a, b) {
          return Math.min(a, b);
        })
        // determine graph height
        graphHeight = 300
        // determine the domain and range
        domain = [min,max]
        range = [0,graphHeight]
    }
    // create scale
    function createTransform(domain, range){
    	// domain is a two-element array of the data bounds [domain_min, domain_max]
    	// range is a two-element array of the screen bounds [range_min, range_max]
    	// this gives you two equations to solve:
    	// range_min = alpha * domain_min + beta
    	// range_max = alpha * domain_max + beta

        var domain_min = domain[0]
        var domain_max = domain[1]
        var range_min = range[0]
        var range_max = range[1]

        // formulas to calculate the alpha and the beta
       	var alpha = (range_max - range_min) / (domain_max - domain_min)
        var beta = range_max - alpha * domain_max
        // returns the function for the linear transformation (y= a * x + b)
        return function(x){
          return alpha * x + beta;
        }
    }

    transformer = createTransform(domain, range)

    // lay-out of the line and canvas
    ctx.strokeStyle = "red"
    ctx.lineWidth = 1
    pointDay = 1
    yCorner = 360
    xCorner = 50
    graphPosition = 100 - 41.605839416058416

    // create the line and canvas
    for (i = 0, j = dates.length; i < j; i+= pointDay)
    {
    	ctx.beginPath();
    	ctx.moveTo((i + xCorner),
    			  (graphHeight + graphPosition) - transformer(temp[i]));
    	ctx.lineTo((i + xCorner + pointDay), (graphHeight + graphPosition) - transformer(temp[i + pointDay]));
    	ctx.stroke();
    }
    // set the x axis
    ctx.beginPath();
    ctx.moveTo(xCorner, yCorner)
    ctx.lineTo(xCorner + dates.length, yCorner)
    ctx.stroke();
    // create an araay with all the months as strings
    var month = new Array();
    month[0] = "Jan";
    month[1] = "Feb";
    month[2] = "Mar";
    month[3] = "Apr";
    month[4] = "May";
    month[5] = "Jun";
    month[6] = "Jul";
    month[7] = "Aug";
    month[8] = "Sept";
    month[9] = "Oct";
    month[10] = "Nov";
    month[11] = "Dec";

    var counter = dates[0].getMonth();
    markerPoint = 10
    markerText = 30

    // draw x axis and add months as markers
    for (i = xCorner, j = xCorner + dates.length; i < j; i ++)
    {
    	if (counter == dates[(i-xCorner)].getMonth())
    	{
    		counter ++;
    		ctx.beginPath();
    		ctx.moveTo(i, yCorner)
    		ctx.lineTo(i, yCorner + markerPoint)
    		ctx.fillText(month[dates[(i - xCorner)].getMonth()],
    					i, yCorner + markerText)
    		ctx.stroke();
    	}
    }



    Yaxis = 320

    // set y axis
    ctx.beginPath();
    ctx.moveTo(xCorner, yCorner)
    ctx.lineTo(xCorner, yCorner - Yaxis)
    ctx.stroke();

    // determine place markers on axis
    yMarkers = 8
    Markertemp = Yaxis / yMarkers


    // draw y axis markers
    for (i = yCorner - Yaxis; i <= yCorner; i ++)
    {
    	if (i % Markertemp == 0)
    	{
     		ctx.beginPath();
    		ctx.moveTo(xCorner, i)
    		ctx.lineTo(xCorner - markerPoint, i)
    		ctx.fillText(i - 80,
    					xCorner - markerText,
    					yCorner - i + Markertemp);
    		ctx.stroke();
    	}
    }
  }
}
// open and send the file
xhttp.open("GET", "KNMI.csv", true);
xhttp.send();

</script>

</body>
</html>
